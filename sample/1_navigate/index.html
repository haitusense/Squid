<!-- 
  dotnet run -- -d -w "..\navigate" -a '{"a" : 10}'
-->
<html lang="en">
<head>
  <meta charset="UTF-8">
</head>

<body>
  <div>navigate</div>
  <div>
    <input type="button" value="Click" onclick="test()"/>
  </div>
</body>

<script async>
/* order of events.

EnsureCoreWebView2Async()
OpenDevToolsWindow()
Add NavigationCompleted Event
AddHostObjectToScript()
 'add cs object'
AddScriptToExecuteOnDocumentCreatedAsync()
 'add js code from cs'
SetCurrentDirectory();
Navigate()
 'html script start'
 'html script end'
 'DOMContentLoaded'
 image,css read
 'load'
webView_NavigationCompleted()
 'NavigationCompleted'

*/
try {
  console.log('html script start');
  if(!window.chrome.webview) throw new Error('webview not found');

  (async () => {
    // 画面遷移しても持ち越されるscriptの追加登録
    const id = await chrome.webview.hostObjects.Squid.GetScriptID("test");
    if(!id) {
      var newID = await chrome.webview.hostObjects.Squid.AddScript("test", "console.log('added script');");
      // window.location.reload();
    }

    //Argsの読み込み
    console.log("print args".green(), SquidJS.args());

    console.log("set window".green());
    SquidJS.setWindowState({
      width : 400,
      // height : 800,
      left : 300,
      top : 0
    });
  })();

  // addEventListener webview message
  window.chrome.webview.addEventListener('message', (e) => {
    let json = e.data;
    switch(json.key){
      case "message":
        console.log(`from cs ${json.key} : ${json.value}`.yellow());
        break;
      default:
        console.log(`from cs ${json.key}`);
        console.log(e);
    }
  });

  // addEventListener DOMContentLoaded
  window.addEventListener('DOMContentLoaded', async () =>{ console.log('DOMContentLoaded'); });

  // addEventListener load
  window.addEventListener('load', async () =>{ console.log('load'); });

  console.log('html script end');

} catch(e) { alert(e) }

// Event
const test = async function() { chrome.webview.hostObjects.Squid.Navigate("navigated.html"); }

</script>
</html>